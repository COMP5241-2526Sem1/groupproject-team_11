<!DOCTYPE html>
<html>

<head>
    <title>Forgot Password</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            red: '#C8102E',
                            darkRed: '#A00A23',
                            lightRed: '#F8E0E6'
                        },
                        neutral: {
                            dark: '#333333',
                            medium: '#666666',
                            light: '#F5F5F5'
                        }
                    },
                    fontFamily: {
                        sans: ['Helvetica Neue', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary-red/50 focus:border-primary-red focus:outline-none transition-all;
            }
            .btn-hover {
                @apply hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300;
            }
            .step-active {
                @apply bg-primary-red text-white border-primary-red;
            }
            .step-completed {
                @apply bg-green-500 text-white border-green-500;
            }
            .step-pending {
                @apply bg-white text-neutral-medium border-gray-300;
            }
            .btn-loading {
                @apply opacity-70 cursor-not-allowed hover:translate-y-0 hover:shadow-none;
            }
            .animate-shake {
                animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            }
            @keyframes shake {
                10%, 90% { transform: translateX(-1px); }
                20%, 80% { transform: translateX(2px); }
                30%, 50%, 70% { transform: translateX(-3px); }
                40%, 60% { transform: translateX(3px); }
            }
        }
    </style>
</head>

<body class="bg-neutral-light font-sans text-neutral-dark min-h-screen">
    <div class="container mx-auto px-4 py-12 md:py-20 flex flex-col items-center justify-center min-h-screen">
        <!-- 进度指示器 -->
        <div class="w-full max-w-md mb-8">
            <div class="flex justify-between items-center">
                <div class="flex flex-col items-center">
                    <div id="step-email"
                        class="w-10 h-10 rounded-full border-2 step-active flex items-center justify-center mb-2">
                        <i class="fa fa-envelope-o"></i>
                    </div>
                    <span class="text-sm font-medium">Email</span>
                </div>
                <div class="flex-1 h-1 mx-2 bg-gray-300">
                    <div id="progress-1" class="h-full w-0 bg-primary-red transition-all duration-500"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div id="step-verify"
                        class="w-10 h-10 rounded-full border-2 step-pending flex items-center justify-center mb-2">
                        <i class="fa fa-key"></i>
                    </div>
                    <span class="text-sm font-medium">Verification</span>
                </div>
                <div class="flex-1 h-1 mx-2 bg-gray-300">
                    <div id="progress-2" class="h-full w-0 bg-primary-red transition-all duration-500"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div id="step-password"
                        class="w-10 h-10 rounded-full border-2 step-pending flex items-center justify-center mb-2">
                        <i class="fa fa-lock"></i>
                    </div>
                    <span class="text-sm font-medium">New Password</span>
                </div>
            </div>
        </div>

        <!-- 卡片容器 -->
        <div
            class="w-full max-w-md bg-white rounded-xl shadow-lg overflow-hidden transform transition-all duration-500">
            <div class="bg-primary-red py-4 px-6">
                <h1 id="step-title" class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-white">Forgot Password</h1>
                <p id="step-description" class="text-primary-lightRed text-sm mt-1">Enter your email to receive a
                    verification code</p>
            </div>

            <div class="p-6 md:p-8">
                <!-- 步骤1：邮箱输入区域 -->
                <div id="email-step" class="space-y-6">
                    <div>
                        <label for="forgot-email" class="block text-sm font-medium text-neutral-dark mb-2">Email
                            Address</label>
                        <input type="email" id="forgot-email"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg input-focus"
                            placeholder="your.email@example.com" required>
                        <p id="email-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address
                        </p>
                        <p id="api-error" class="text-red-500 text-sm mt-1 hidden">Failed to send code, please try again
                            later</p>
                        <p id="debug-info" class="text-blue-500 text-xs mt-1 hidden"></p> <!-- 调试信息 -->
                    </div>

                    <button id="send-code-btn"
                        class="w-full bg-primary-red hover:bg-primary-darkRed text-white font-medium py-3 px-4 rounded-lg btn-hover">
                        <span id="btn-text">Send Verification Code</span>
                        <span id="btn-loading" class="hidden"><i
                                class="fa fa-spinner fa-spin mr-2"></i>Sending...</span>
                    </button>

                    <button id="back-to-login-btn"
                        class="w-full bg-transparent border border-gray-300 text-neutral-dark font-medium py-3 px-4 rounded-lg hover:bg-primary-lightRed hover:border-primary-red/30 transition-colors">
                        Back to Login
                    </button>
                </div>

                <!-- 步骤2：验证码区域 -->
                <div id="verify-step" class="space-y-6 hidden">
                    <div>
                        <label class="block text-sm font-medium text-neutral-dark mb-3">Enter 6-digit verification
                            code</label>
                        <div class="flex justify-between gap-2 mb-4">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="0" inputmode="numeric" pattern="[0-9]">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="1" inputmode="numeric" pattern="[0-9]">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="2" inputmode="numeric" pattern="[0-9]">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="3" inputmode="numeric" pattern="[0-9]">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="4" inputmode="numeric" pattern="[0-9]">
                            <input type="text" maxlength="1"
                                class="verify-input w-12 h-12 text-center text-lg border-2 border-gray-300 rounded-lg input-focus"
                                data-index="5" inputmode="numeric" pattern="[0-9]">
                        </div>
                        <p id="verification-error" class="text-red-500 text-sm mt-1 hidden">Invalid verification code
                        </p>

                        <div class="text-center">
                            <p class="text-neutral-medium">
                                Didn't receive the code?
                                <button id="resend-btn" class="text-primary-red hover:underline font-medium">Resend
                                    Code</button>
                                <span id="resend-timer" class="hidden text-neutral-medium"> (Resend in <span
                                        id="countdown">60</span>s)</span>
                            </p>
                        </div>
                    </div>

                    <button id="verify-code-btn"
                        class="w-full bg-primary-red hover:bg-primary-darkRed text-white font-medium py-3 px-4 rounded-lg btn-hover"
                        disabled>
                        <span id="verify-btn-text">Verify & Continue</span>
                        <span id="verify-btn-loading" class="hidden"><i
                                class="fa fa-spinner fa-spin mr-2"></i>Verifying...</span>
                    </button>

                    <button id="back-to-email-btn"
                        class="w-full bg-transparent border border-gray-300 text-neutral-dark font-medium py-3 px-4 rounded-lg hover:bg-primary-lightRed hover:border-primary-red/30 transition-colors">
                        Back to Email
                    </button>
                </div>

                <!-- 步骤3：密码重置区域 -->
                <div id="password-step" class="space-y-6 hidden">
                    <div>
                        <label for="new-password" class="block text-sm font-medium text-neutral-dark mb-2">New
                            Password</label>
                        <input type="password" id="new-password"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg input-focus"
                            placeholder="Create your new password" required>
                    </div>

                    <div>
                        <label for="confirm-password" class="block text-sm font-medium text-neutral-dark mb-2">Confirm
                            New Password</label>
                        <input type="password" id="confirm-password"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg input-focus"
                            placeholder="Confirm your new password" required>
                        <p id="password-mismatch" class="text-red-500 text-sm mt-1 hidden">Passwords do not match</p>
                    </div>

                    <div class="mt-4">
                        <p class="text-sm font-medium text-neutral-medium mb-2">Password must meet the following
                            requirements:</p>
                        <ul class="space-y-1 text-sm">
                            <li id="req-length" class="text-red-500">
                                <i class="fa fa-times-circle mr-2"></i><span>At least 8 characters</span>
                            </li>
                            <li id="req-uppercase" class="text-red-500">
                                <i class="fa fa-times-circle mr-2"></i><span>At least one uppercase letter</span>
                            </li>
                            <li id="req-lowercase" class="text-red-500">
                                <i class="fa fa-times-circle mr-2"></i><span>At least one lowercase letter</span>
                            </li>
                            <li id="req-number" class="text-red-500">
                                <i class="fa fa-times-circle mr-2"></i><span>At least one number</span>
                            </li>
                        </ul>
                    </div>

                    <button id="reset-password-btn"
                        class="w-full bg-gray-400 cursor-not-allowed text-white font-medium py-3 px-4 rounded-lg btn-hover"
                        disabled>
                        <span id="reset-btn-text">Reset Password</span>
                        <span id="reset-btn-loading" class="hidden"><i
                                class="fa fa-spinner fa-spin mr-2"></i>Resetting...</span>
                    </button>

                    <button id="back-to-verify-btn"
                        class="w-full bg-transparent border border-gray-300 text-neutral-dark font-medium py-3 px-4 rounded-lg hover:bg-primary-lightRed hover:border-primary-red/30 transition-colors">
                        Back to Verification
                    </button>
                </div>

                <p id="network-error" class="text-red-500 text-sm mt-4 hidden">Network error. Please check your
                    connection and try again.</p>
                <p id="server-error" class="text-red-500 text-sm mt-4 hidden">Server error. Please try again later.</p>
                <p id="detailed-error" class="text-red-500 text-sm hidden"></p>
            </div>
        </div>
    </div>

    <script>
        // DOM元素
        const emailStep = document.getElementById('email-step');
        const verifyStep = document.getElementById('verify-step');
        const passwordStep = document.getElementById('password-step');
        const stepTitle = document.getElementById('step-title');
        const stepDescription = document.getElementById('step-description');
        const stepEmail = document.getElementById('step-email');
        const stepVerify = document.getElementById('step-verify');
        const stepPassword = document.getElementById('step-password');
        const progress1 = document.getElementById('progress-1');
        const progress2 = document.getElementById('progress-2');

        const emailInput = document.getElementById('forgot-email');
        const sendCodeBtn = document.getElementById('send-code-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoading = document.getElementById('btn-loading');
        const backToLoginBtn = document.getElementById('back-to-login-btn');
        const debugInfo = document.getElementById('debug-info');

        const verifyInputs = document.querySelectorAll('.verify-input');
        const verifyCodeBtn = document.getElementById('verify-code-btn');
        const verifyBtnText = document.getElementById('verify-btn-text');
        const verifyBtnLoading = document.getElementById('verify-btn-loading');
        const backToEmailBtn = document.getElementById('back-to-email-btn');
        const resendBtn = document.getElementById('resend-btn');
        const resendTimer = document.getElementById('resend-timer');
        const countdown = document.getElementById('countdown');

        const passwordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const resetPasswordBtn = document.getElementById('reset-password-btn');
        const resetBtnText = document.getElementById('reset-btn-text');
        const resetBtnLoading = document.getElementById('reset-btn-loading');
        const backToVerifyBtn = document.getElementById('back-to-verify-btn');

        // 密码要求元素
        const reqLength = document.getElementById('req-length');
        const reqUppercase = document.getElementById('req-uppercase');
        const reqLowercase = document.getElementById('req-lowercase');
        const reqNumber = document.getElementById('req-number');

        // 错误元素
        const emailError = document.getElementById('email-error');
        const apiError = document.getElementById('api-error');
        const verificationError = document.getElementById('verification-error');
        const passwordMismatch = document.getElementById('password-mismatch');
        const networkError = document.getElementById('network-error');
        const serverError = document.getElementById('server-error');
        const detailedError = document.getElementById('detailed-error');

        // API配置
        const apiConfig = {
            checkEmailUrl: 'http://43.163.233.241:8081/account/resetPsw/email/checkEmail',
            verifyCodeUrl: 'http://43.163.233.241:8081/account/resetPsw/email/captchaVerify',
            resetPasswordUrl: 'http://43.163.233.241:8081/account/resetPsw/email/resetPsw',
            timeout: 10000
        };

        // 当前邮箱（用内存变量替代localStorage，避免跟踪防护问题）
        let currentEmail = '';
        // 倒计时计时器
        let countdownTimer = null;

        // 初始化事件监听
        function initEventListeners() {
            sendCodeBtn.addEventListener('click', checkEmailAndSendCode);
            backToLoginBtn.addEventListener('click', () => window.location.href = 'login.html');
            verifyInputs.forEach(input => {
                input.addEventListener('input', handleVerifyInput);
                input.addEventListener('keydown', handleVerifyKeydown);
            });
            verifyCodeBtn.addEventListener('click', verifyCode);
            backToEmailBtn.addEventListener('click', goToEmailStep);
            resendBtn.addEventListener('click', resendVerificationCode);
            passwordInput.addEventListener('input', validatePassword);
            confirmPasswordInput.addEventListener('input', validatePassword);
            resetPasswordBtn.addEventListener('click', resetPassword);
            backToVerifyBtn.addEventListener('click', goToVerifyStep);
        }

        /**
         * 密码验证核心函数
         */
        function validatePassword() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // 1. 检查长度（至少8个字符）
            const isLengthValid = password.length >= 8;
            updateRequirementStatus(reqLength, isLengthValid);

            // 2. 检查是否包含大写字母
            const hasUppercase = /[A-Z]/.test(password);
            updateRequirementStatus(reqUppercase, hasUppercase);

            // 3. 检查是否包含小写字母
            const hasLowercase = /[a-z]/.test(password);
            updateRequirementStatus(reqLowercase, hasLowercase);

            // 4. 检查是否包含数字
            const hasNumber = /[0-9]/.test(password);
            updateRequirementStatus(reqNumber, hasNumber);

            // 5. 检查两次输入是否一致
            const isMatch = password === confirmPassword && password !== '';
            if (!isMatch) {
                passwordMismatch.classList.remove('hidden');
            } else {
                passwordMismatch.classList.add('hidden');
            }

            // 启用/禁用重置按钮（所有条件都满足才启用）
            const allValid = isLengthValid && hasUppercase && hasLowercase && hasNumber && isMatch;
            if (allValid) {
                resetPasswordBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                resetPasswordBtn.classList.add('bg-primary-red', 'hover:bg-primary-darkRed');
                resetPasswordBtn.disabled = false;
            } else {
                resetPasswordBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                resetPasswordBtn.classList.remove('bg-primary-red', 'hover:bg-primary-darkRed');
                resetPasswordBtn.disabled = true;
            }

            // 输出调试信息
            console.log(`Debug: Length=${isLengthValid}, Uppercase=${hasUppercase}, Lowercase=${hasLowercase}, Number=${hasNumber}, Match=${isMatch}`);
        }

        /**
         * 更新密码要求项的UI状态
         */
        function updateRequirementStatus(element, isValid) {
            const textContent = element.querySelector('span').textContent;
            if (isValid) {
                element.classList.remove('text-red-500');
                element.classList.add('text-green-500');
                element.innerHTML = `<i class="fa fa-check-circle mr-2"></i><span>${textContent}</span>`;
            } else {
                element.classList.add('text-red-500');
                element.classList.remove('text-green-500');
                element.innerHTML = `<i class="fa fa-times-circle mr-2"></i><span>${textContent}</span>`;
            }
        }

        /**
         * 检查邮箱并发送验证码
         */
        async function checkEmailAndSendCode() {
            resetErrors();
            const email = emailInput.value.trim();

            if (!isValidEmail(email)) {
                showError(emailError, 'Please enter a valid email address');
                emailInput.classList.add('animate-shake', 'border-red-500');
                setTimeout(() => emailInput.classList.remove('animate-shake', 'border-red-500'), 500);
                return;
            }

            setLoadingState(sendCodeBtn, btnText, btnLoading, true);

            try {
                console.log('发送邮箱请求:', email);
                const response = await fetch(apiConfig.checkEmailUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email }),
                });

                console.log('响应状态码:', response.status);
                debugInfo.textContent = `Debug: Status=${response.status}`;
                debugInfo.classList.remove('hidden');

                if (response.ok) {
                    currentEmail = email;
                    goToVerifyStep();
                    startCountdown();
                } else {
                    showError(apiError, 'Failed to send code, please try again later');
                }
            } catch (error) {
                console.error('发送验证码错误:', error);
                showError(networkError, 'Network error. Please check your connection.');
            } finally {
                setLoadingState(sendCodeBtn, btnText, btnLoading, false);
            }
        }

        /**
         * 验证邮箱格式
         */
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        /**
         * 处理验证码输入
         */
        function handleVerifyInput(e) {
            const input = e.target;
            const value = input.value.replace(/[^0-9]/g, ''); // 只保留数字
            input.value = value;

            // 自动跳到下一个输入框
            if (value) {
                const nextInput = document.querySelector(`.verify-input[data-index="${parseInt(input.dataset.index) + 1}"]`);
                if (nextInput) {
                    nextInput.focus();
                }
            }

            // 检查是否所有输入框都已填写
            checkVerifyComplete();
        }

        /**
         * 处理验证码输入框键盘事件
         */
        function handleVerifyKeydown(e) {
            const input = e.target;
            // 退格键且当前输入框为空时，聚焦到上一个输入框
            if (e.key === 'Backspace' && !input.value) {
                const prevInput = document.querySelector(`.verify-input[data-index="${parseInt(input.dataset.index) - 1}"]`);
                if (prevInput) {
                    prevInput.focus();
                }
            }
        }

        /**
         * 检查验证码是否填写完整
         */
        function checkVerifyComplete() {
            let isComplete = true;
            verifyInputs.forEach(input => {
                if (!input.value) {
                    isComplete = false;
                }
            });
            verifyCodeBtn.disabled = !isComplete;
        }

        /**
         * 验证验证码
         */
        async function verifyCode() {
            resetErrors();
            const code = Array.from(verifyInputs).map(input => input.value).join('');

            setLoadingState(verifyCodeBtn, verifyBtnText, verifyBtnLoading, true);

            try {
                const response = await fetch(apiConfig.verifyCodeUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: currentEmail,
                        captcha: code
                    }),
                });

                if (response.ok) {
                    goToPasswordStep();
                } else {
                    showError(verificationError, 'Invalid verification code');
                    verifyInputs.forEach(input => {
                        input.classList.add('animate-shake', 'border-red-500');
                        setTimeout(() => input.classList.remove('animate-shake', 'border-red-500'), 500);
                    });
                }
            } catch (error) {
                console.error('验证验证码错误:', error);
                showError(networkError, 'Network error. Please check your connection.');
            } finally {
                setLoadingState(verifyCodeBtn, verifyBtnText, verifyBtnLoading, false);
            }
        }

        /**
         * 重发验证码
         */
        async function resendVerificationCode() {
            resetErrors();
            resendBtn.disabled = true;

            try {
                const response = await fetch(apiConfig.checkEmailUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: currentEmail }),
                });

                if (response.ok) {
                    startCountdown();
                } else {
                    showError(apiError, 'Failed to resend code, please try again later');
                    resendBtn.disabled = false;
                }
            } catch (error) {
                console.error('重发验证码错误:', error);
                showError(networkError, 'Network error. Please check your connection.');
                resendBtn.disabled = false;
            }
        }

        /**
         * 开始倒计时
         */
        function startCountdown() {
            let seconds = 60;
            resendBtn.classList.add('hidden');
            resendTimer.classList.remove('hidden');
            countdown.textContent = seconds;

            if (countdownTimer) {
                clearInterval(countdownTimer);
            }

            countdownTimer = setInterval(() => {
                seconds--;
                countdown.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(countdownTimer);
                    resendTimer.classList.add('hidden');
                    resendBtn.classList.remove('hidden');
                    resendBtn.disabled = false;
                }
            }, 1000);
        }

        /**
         * 重置密码
         */
        async function resetPassword() {
            resetErrors();
            const newPassword = passwordInput.value;

            setLoadingState(resetPasswordBtn, resetBtnText, resetBtnLoading, true);

            try {
                const response = await fetch(apiConfig.resetPasswordUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: currentEmail,
                        newPassword: newPassword
                    }),
                });

                if (response.ok) {
                    // 密码重置成功，跳转到登录页或显示成功消息
                    window.location.href = 'login.html?reset=success';
                } else {
                    const errorData = await response.json().catch(() => null);
                    showError(detailedError, errorData?.message || 'Failed to reset password');
                }
            } catch (error) {
                console.error('重置密码错误:', error);
                showError(networkError, 'Network error. Please check your connection.');
            } finally {
                setLoadingState(resetPasswordBtn, resetBtnText, resetBtnLoading, false);
            }
        }

        /**
         * 切换到邮箱步骤
         */
        function goToEmailStep() {
            emailStep.classList.remove('hidden');
            verifyStep.classList.add('hidden');
            passwordStep.classList.add('hidden');

            stepTitle.textContent = 'Forgot Password';
            stepDescription.textContent = 'Enter your email to receive a verification code';

            stepEmail.classList.remove('step-pending');
            stepEmail.classList.add('step-active');
            stepVerify.classList.remove('step-active', 'step-completed');
            stepVerify.classList.add('step-pending');
            stepPassword.classList.remove('step-active', 'step-completed');
            stepPassword.classList.add('step-pending');

            progress1.style.width = '0%';
            progress2.style.width = '0%';
        }

        /**
         * 切换到验证步骤
         */
        function goToVerifyStep() {
            emailStep.classList.add('hidden');
            verifyStep.classList.remove('hidden');
            passwordStep.classList.add('hidden');

            stepTitle.textContent = 'Verify Your Email';
            stepDescription.textContent = 'Enter the 6-digit code sent to your email';

            stepEmail.classList.remove('step-active');
            stepEmail.classList.add('step-completed');
            stepVerify.classList.remove('step-pending');
            stepVerify.classList.add('step-active');
            stepPassword.classList.remove('step-active', 'step-completed');
            stepPassword.classList.add('step-pending');

            progress1.style.width = '100%';
            progress2.style.width = '0%';

            // 聚焦第一个验证码输入框
            verifyInputs[0].focus();
        }

        /**
         * 切换到密码步骤
         */
        function goToPasswordStep() {
            emailStep.classList.add('hidden');
            verifyStep.classList.add('hidden');
            passwordStep.classList.remove('hidden');

            stepTitle.textContent = 'Create New Password';
            stepDescription.textContent = 'Set a new password for your account';

            stepEmail.classList.remove('step-active');
            stepEmail.classList.add('step-completed');
            stepVerify.classList.remove('step-active');
            stepVerify.classList.add('step-completed');
            stepPassword.classList.remove('step-pending');
            stepPassword.classList.add('step-active');

            progress1.style.width = '100%';
            progress2.style.width = '100%';

            // 聚焦密码输入框
            passwordInput.focus();
        }

        /**
         * 显示错误信息
         */
        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        /**
         * 重置所有错误信息
         */
        function resetErrors() {
            [emailError, apiError, verificationError, passwordMismatch,
                networkError, serverError, detailedError].forEach(el => {
                    el.classList.add('hidden');
                });
        }

        /**
         * 设置按钮加载状态
         */
        function setLoadingState(button, textElement, loadingElement, isLoading) {
            if (isLoading) {
                textElement.classList.add('hidden');
                loadingElement.classList.remove('hidden');
                button.disabled = true;
                button.classList.add('btn-loading');
            } else {
                textElement.classList.remove('hidden');
                loadingElement.classList.add('hidden');
                button.disabled = false;
                button.classList.remove('btn-loading');
            }
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
        });
    </script>
</body>

</html>